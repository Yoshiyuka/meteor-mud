<!DOCTYPE html><html lang="en"><head><title>client/signin</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="client/signin"><meta name="groc-project-path" content="client/signin.coffee"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">client/signin.coffee</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="signincoffee">signin.coffee</h1>

<p>Event listeners for both the Sign In and Create Account forms.  </p></div></div><div class="code"><div class="wrapper">  </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="sign-in-forms-event-listener">Sign In Form's Event Listener</h3></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="nx">Template</span><span class="p">.</span><span class="nx">sign_in_body</span><span class="p">.</span><span class="nx">events</span><span class="p">({</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>'submit' event - 'e' is the event and 't' is the template instance</li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="s">&#39;submit #sign-in-form&#39;</span> <span class="o">:</span> <span class="nf">(e, t) -&gt;</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
        <span class="nv">email = </span><span class="nx">t</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;#accountEmail&#39;</span><span class="p">).</span><span class="nx">value</span>
        <span class="nv">password = </span><span class="nx">t</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;#accountPassword&#39;</span><span class="p">).</span><span class="nx">value</span>

        <span class="c1">#To Do: Trim and validate input. </span>
        <span class="nx">Meteor</span><span class="p">.</span><span class="nx">loginWithPassword</span><span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="nf">(err) -&gt;</span>
            <span class="k">if</span> <span class="nx">err</span>
                <span class="c1">#TODO: Properly handle error.... don&#39;t just ignore them!</span>
            <span class="k">else</span>
                <span class="c1">#TODO: Handle login success.</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="kc">false</span>
<span class="p">})</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="create-account-forms-event-listener">Create Account Form's Event Listener</h3></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="nx">Template</span><span class="p">.</span><span class="nx">create_account_body</span><span class="p">.</span><span class="nx">events</span><span class="p">({</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>'click' event for the Create Account form. This clears any color status indicators from the fields of the form when the user clicks on the form.</li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="s">&#39;click #create-account-form&#39;</span> <span class="o">:</span> <span class="nf">(e) -&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#accountError&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s">&quot;visibility&quot;</span><span class="p">,</span> <span class="s">&quot;hidden&quot;</span><span class="p">)</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&#39;.form-group&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&#39;has-error&#39;</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>'submit' event for the Create Account form. 'e' is the event and 't' is the template instance.</li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="s">&#39;submit #create-account-form&#39;</span> <span class="o">:</span> <span class="nf">(e, t) -&gt;</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
        <span class="nv">email = </span><span class="nx">t</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;#accountEmail&#39;</span><span class="p">).</span><span class="nx">value</span>
        <span class="nv">password = </span><span class="nx">t</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;#accountPassword&#39;</span><span class="p">).</span><span class="nx">value</span>
        <span class="nv">confirmPassword = </span><span class="nx">t</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;#accountPasswordConfirm&#39;</span><span class="p">).</span><span class="nx">value</span>

        <span class="k">if</span> <span class="nx">confirmPassword</span> <span class="o">isnt</span> <span class="nx">password</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#accountError&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s">&quot;&lt;p&gt;Passwords do not match. Please reconfirm your password&lt;/p&gt;&quot;</span><span class="p">)</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#accountError&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s">&quot;visibility&quot;</span><span class="p">,</span> <span class="s">&quot;visible&quot;</span><span class="p">)</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#password_group&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&#39;has-error&#39;</span><span class="p">)</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#password_confirm_group&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&#39;has-error&#39;</span><span class="p">)</span>
        <span class="k">else</span>
            <span class="nx">Accounts</span><span class="p">.</span><span class="nx">createUser</span><span class="p">({</span><span class="nv">email: </span><span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">},</span> <span class="nf">(err) -&gt;</span>
                <span class="k">if</span> <span class="nx">err</span>
                    <span class="c1">#TODO: Properly handle error... don&#39;t just ignore them!</span>
                    <span class="k">if</span> <span class="nx">err</span><span class="p">.</span><span class="nx">error</span> <span class="o">is</span> <span class="mi">403</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#accountError&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s">&quot;&lt;p&gt;That account already exists!&lt;/p&gt;&quot;</span><span class="p">)</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#accountError&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s">&quot;visibility&quot;</span><span class="p">,</span> <span class="s">&quot;visible&quot;</span><span class="p">)</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#email_group&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&#39;has-error&#39;</span><span class="p">)</span>
                <span class="k">else</span>
                    <span class="c1">#TODO: Ideally we would display a success message rather than silently sending the user back to the previous page.</span>
                    <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">back</span><span class="p">()</span>
            <span class="p">)</span>
<span class="p">})</span></div></div></div></div></body></html>