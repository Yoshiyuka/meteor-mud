<!DOCTYPE html><html lang="en"><head><title>lib/inventory</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="lib/inventory"><meta name="groc-project-path" content="lib/inventory.coffee"><meta name="groc-github-url" content="https://github.com/Yoshiyuka/meteor-mud"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/Yoshiyuka/meteor-mud/blob/master/lib/inventory.coffee">lib/inventory.coffee</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="inventory">Inventory</h1>

<hr />

<p><strong>Holds an array of item documents fetched from the mongodb Items collection.
Also provides methods for adding, removing, and iterating through the item array.</strong></p></div></div><div class="code"><div class="wrapper"><span class="k">class</span> <span class="nx">Inventory</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><strong>constructor(Object, Number)</strong> - initialize the Inventory class with default values. <br />
- parent: the object this component is attached to. <br />
- container_size: maximum number of items the inventory can hold.</p></div></div><div class="code"><div class="wrapper">    <span class="nv">constructor: </span><span class="nf">(@parent, @container_size) -&gt;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;inventory created&quot;</span>
        <span class="c1">#Array of item ids indexing into the Items collection. Used as a base to generate variations of each item.</span>
        <span class="c1">#@item_templates = []</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Object containing generated item documents. <strong>Key: String, Value: Object</strong></p></div></div><div class="code"><div class="wrapper">        <span class="vi">@items = </span><span class="p">{}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>(Number) <strong>size(void)</strong> - returns maximum inventory size.</p></div></div><div class="code"><div class="wrapper">    <span class="nv">size: </span><span class="p">()</span> <span class="nf">-&gt;</span>  <span class="k">return</span> <span class="nx">@container_size</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>(Number) <strong>count(void)</strong> - returns number of items currently in the inventory.
While looping across items and tallying them up ensures returning actual size, it would be more efficient (in the future)
to simply add/subtract from a count variable when inventory is modified and return that value.</p></div></div><div class="code"><div class="wrapper">    <span class="nv">count: </span><span class="p">()</span> <span class="nf">-&gt;</span>
        <span class="nv">result = </span><span class="mi">0</span>
        <span class="k">for</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">@items</span>
            <span class="nx">result</span> <span class="o">+=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">amount</span>

        <span class="k">return</span> <span class="nx">result</span>

    <span class="c1">#region Add Item</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>(Number) <strong>addItem(Object, Number)</strong> - 
adds one (default) or more item documents to this Inventory instance. Returns item id on success, (void 0) on failure.</p></div></div><div class="code"><div class="wrapper">    <span class="nv">addItem: </span><span class="nf">(item, amount = 1) -&gt;</span>
        <span class="k">if</span> <span class="nx">@count</span><span class="p">()</span> <span class="o">+</span> <span class="nx">amount</span> <span class="o">&lt;</span> <span class="nx">@size</span><span class="p">()</span>
            <span class="k">if</span> <span class="o">not</span> <span class="nx">@items</span><span class="p">[</span><span class="nx">item</span><span class="p">.</span><span class="nx">_id</span><span class="p">]</span><span class="o">?</span>
                <span class="nx">@items</span><span class="p">[</span><span class="nx">item</span><span class="p">.</span><span class="nx">_id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">item</span>
                <span class="nx">@items</span><span class="p">[</span><span class="nx">item</span><span class="p">.</span><span class="nx">_id</span><span class="p">].</span><span class="nv">amount = </span><span class="nx">amount</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nx">EJSON</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">@items</span><span class="p">[</span><span class="nx">item</span><span class="p">.</span><span class="nx">_id</span><span class="p">],</span> <span class="nx">item</span><span class="p">)</span>
                <span class="nx">@items</span><span class="p">[</span><span class="nx">item</span><span class="p">.</span><span class="nx">_id</span><span class="p">].</span><span class="nx">amount</span> <span class="o">+=</span> <span class="nx">amount</span>
            <span class="k">else</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;malformed object/object id&quot;</span>

            <span class="k">return</span> <span class="nx">item</span><span class="p">.</span><span class="nx">_id</span>
        <span class="k">else</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;INVENTORY LIMIT REACHED&quot;</span>
            <span class="k">return</span> <span class="kc">undefined</span>
    <span class="c1">#endregion</span>

    <span class="c1">#region Remove Item</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><strong>removeItem(String, Number)</strong> - removes one (default) or more item documents (matching item_id) from this Inventory instance</p></div></div><div class="code"><div class="wrapper">    <span class="nv">removeItem: </span><span class="nf">(item_id, amount = 1) -&gt;</span>
        <span class="k">if</span> <span class="nx">@items</span><span class="p">[</span><span class="nx">item_id</span><span class="p">]</span><span class="o">?</span>
            <span class="nx">@items</span><span class="p">[</span><span class="nx">item_id</span><span class="p">].</span><span class="nx">amount</span> <span class="o">-=</span> <span class="nx">amount</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>remove item<em>id index in this.items if there are no more items matching item</em>id</p></div></div><div class="code"><div class="wrapper">            <span class="k">if</span> <span class="nx">@items</span><span class="p">[</span><span class="nx">item_id</span><span class="p">].</span><span class="nx">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span>
                <span class="k">delete</span> <span class="nx">@items</span><span class="p">[</span><span class="nx">item_id</span><span class="p">]</span>
    <span class="c1">#endregion</span>
            </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>(Array) <strong>getItem(String Number)</strong> - returns one or more item documents (as an array)  </p></div></div><div class="code"><div class="wrapper">    <span class="nv">getItem: </span><span class="nf">(item_id, amount = 1) -&gt;</span>
            
    <span class="nv">listItems: </span><span class="p">()</span> <span class="nf">-&gt;</span>
        <span class="c1">#iterate through all items in inventory and return as string</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><strong>Make the Inventory class available to all .coffee files in the project.</strong></p></div></div><div class="code"><div class="wrapper"><span class="nv">share.Inventory = </span><span class="nx">Inventory</span>

<span class="c1">#UNUSED ITEM TEMPLATE FUNCTIONS - INVENTORY SHOULD ONLY BE RESPONSIBLE FOR *ALREADY GENERATED* ITEMS! ITEM GENERATION SHOULD BE HANDLED ELSEWHERE.</span>
    <span class="c1">#**addItemTemplate(String)** - add the item_id to the item template array for use in looking up templates from the Items collection. </span>
    <span class="c1">#addItemTemplate: (item_id) -&gt;</span>

    <span class="c1">#**removeItemTemplate(String)** - remove the item_id from the item template array</span>
    <span class="c1">#removeItemTemplate: (item_id) -&gt;</span></div></div></div></div></body></html>